<div class="product-card-with-size-wrap" data-product-category="{{ product.category }}" data-resolution="{{ product.metafields.custom.sun_capabilities | handleize }}">
  <div class="pdc-image-and-sizes">
    <div class="pdc-feat-image">
      <a href="{{ product.url }}">
      <img src="{{ product.featured_image | image_url: width: 500 }}" alt="">
      </a>
    </div>
    {% if product.category == 'Television' or product.category == 'Televisions' %}
    <div class="pdc-sizes">
      {%- liquid
        assign size_option = nil
        assign size_labels = 'resolution size,size,sizes,screen size,tv size,inch,inches,diagonal' | split: ','
        for opt in product.options_with_values
          assign opt_name = opt.name | downcase | strip
          if size_labels contains opt_name
            assign size_option = opt
            break
          endif
        endfor
      -%}
      {%- if size_option and size_option.values and size_option.values.size > 1 -%}
        {%- for ov in size_option.values -%}
          {%- assign raw_val = ov.value | default: ov -%}
          {%- assign display_val = raw_val | strip
            | remove: '"' | remove: '”' | remove: '″'
            | remove: "'" | remove: '’' | remove: '‘' -%}

          {%- assign matched_variant = nil -%}
          {%- for v in product.variants -%}
            {%- case size_option.position -%}
              {%- when 1 -%}{% if v.option1 == raw_val %}{% assign matched_variant = v %}{% break %}{% endif %}
              {%- when 2 -%}{% if v.option2 == raw_val %}{% assign matched_variant = v %}{% break %}{% endif %}
              {%- when 3 -%}{% if v.option3 == raw_val %}{% assign matched_variant = v %}{% break %}{% endif %}
            {%- endcase -%}
          {%- endfor -%}

          {%- if matched_variant -%}
            <a href="{{ matched_variant.url }}" data-instant class="pdc-size {% if matched_variant.url == product.url %}active{% endif %} {% unless matched_variant.available %}is-sold-out{% endunless %}">
              <span class="product__title">
              {{ display_val }}
              </span>
            </a>
          {%- else -%}
            <span class="is-disabled">{{ display_val }}&Prime;</span>
          {%- endif -%}
        {%- endfor -%}
      {%- else -%}
        {% paginate collections.all.products by 250 %}
          {% assign product_handle_split = product.handle | split : '-'  %}
          {% assign product_current_size = product_handle_split[0] | append: '-' | append: product_handle_split[1] %}
          {% assign common_handle = product.handle | remove : product_current_size %}
          {% assign collections_by_suffix = collections.all.products | where: 'template_suffix', product.template_suffix %}
          {% assign collections_by_suffix = collections_by_suffix | sort: 'title' %}
          {% assign collection_product_count = collections_by_suffix | size %}
          {% if product.template_suffix != '' %}
          {% unless product.template_suffix == 'installation-service' %}
            {% if collection_product_count > 1 %}
              {% for get_product in collections_by_suffix %}
                {% if get_product.handle contains common_handle %}
                  <a href="{{ get_product.url }}" data-product-base="{{ product.template_suffix }}" class="pdc-size {% if get_product.url == product.url %}active{% endif %}">
                    <span class="product__title">
                    {{ get_product.title | split : '"' | first | remove: 'Sylvox Cinema Pro' }}"
                    </span>
                  </a>
                {% endif %}
              {% endfor %}
            {% endif %}
          {% endunless %}
          {% endif %}
        {% endpaginate %}
      {%- endif -%}
    </div>
    {% endif %}
  </div>
  <div class="pdc-details">
    <div class="pdc-tv-specs">
      <div class="pdc-tv-product-type">
        {{ product.metafields.custom.product_type | default: 'Outdoor TV' }}
      </div>
      <div class="pdc-tv-sun-capabilities">
        {% assign sun_icon = product.metafields.custom.sun_capabilities | downcase %}
        {% render 'sun-icons', icon: sun_icon %}{{ product.metafields.custom.sun_capabilities }}
      </div>
    </div>
    {% assign split_product_title = product.title | split : '-' | last %}
    <div class="pdc-title">{{ product.title | split : '"' | first }}" {{ split_product_title }}</div>
    <div class="pdc-tv-type">
      {% if product.metafields.shopify.smart-tv-platform %}
        {% for platform in product.metafields.shopify.smart-tv-platform.value %}
          {{ platform.label }}
          {% break %}
        {% endfor %}
      {% else %}
        {% if product.title contains 'Google' %}
          Google TV
        {% endif %}
      {% endif %}
    </div>
    
    <div class="pdc-price-min">From {{ product.price_min | money_with_currency }}</div>
  </div>
</div>