{% schema %}
{
  "name": "Somos Image/Text Block",
  "max_blocks": 20,
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "background_gradient",
      "label": "Background Gradient (CSS)",
      "info": "Example: linear-gradient(135deg, #ff7e5f, #feb47b)"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "default": "standard",
      "options": [
        { "value": "standard", "label": "50% Width" },
        { "value": "full", "label": "Full Width" }
      ]
    },
    {
      "type": "select",
      "id": "section_content_width",
      "label": "Content Width",
      "default": "standard",
      "options": [
        { "value": "standard", "label": "50% Width" },
        { "value": "full", "label": "Full Width" }
      ]
    },
    {
      "type": "checkbox",
      "id": "narrow_container",
      "label": "Narrow Container",
      "default": false
    },
    {
      "type": "select",
      "id": "alignment",
      "label": "Content Alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    { "type": "range", "id": "padding_top", "label": "Padding top", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Padding bottom", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "padding_left", "label": "Padding left", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "padding_right", "label": "Padding right", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "margin_top", "label": "Margin top", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "margin_bottom", "label": "Margin bottom", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "margin_left", "label": "Margin left", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    { "type": "range", "id": "margin_right", "label": "Margin right", "min": 0, "max": 100, "step": 5, "default": 0, "unit": "px" },
    {
      "type": "color",
      "id": "button_background_color",
      "label": "Button Background Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_outline_color",
      "label": "Button Outline Color",
      "default": "#ffffff"
    },
    {
      "type": "text",
      "id": "button_icon",
      "label": "Button Icon (optional)",
      "default": "none"
    },
    {
      "type": "select",
      "id": "button_icon_position",
      "label": "Button Icon Position",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button Size",
      "default": "medium",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" }
      ]
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "select",
          "id": "image_alignment",
          "label": "Image Alignment",
          "default": "center",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ]
        },
        {
          "type": "range",
          "id": "image_width",
          "label": "Image Width (%)",
          "min": 1,
          "max": 100,
          "step": 1,
          "default": 100,
          "unit": "%"
        },
        {
          "type": "checkbox",
          "id": "use_mobile_width",
          "label": "Use Different Size on Mobile",
          "default": false
        },
        {
          "type": "range",
          "id": "mobile_image_width",
          "label": "Image Mobile Width (%)",
          "min": 1,
          "max": 100,
          "step": 1,
          "default": 100,
          "unit": "%"
        }

      ]
    },
    {
      "type": "title",
      "name": "Title",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title Text",
          "default": "Your Section Title"
        },
        {
          "type": "range",
          "id": "font_size",
          "min": 12,
          "max": 60,
          "step": 1,
          "unit": "px",
          "label": "Font size",
          "default": 48
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Color",
          "default": "#000000"
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Paragraph Text",
          "default": "Some supporting content that explains your product or story."
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Color",
          "default": "#000000"
        }
      ]
    },
    {
  "type": "paragraph",
  "name": "Paragraph with Font Size",
  "settings": [
    {
      "type": "textarea",
      "id": "text",
      "label": "Paragraph Text",
      "default": "Your paragraph content goes here."
    },
    {
      "type": "range",
      "id": "font_size",
      "label": "Font Size",
      "min": 12,
      "max": 48,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color",
      "default": "#000000"
    }
  ]
},
    {
      "type": "button",
      "name": "Button",
      "settings": [
        { "type": "text", "id": "text", "label": "Text" },
        { "type": "url", "id": "url", "label": "Link" },
        { "type": "select", "id": "style", "label": "Style", "default": "fill", "options": [
          { "value": "fill", "label": "Fill" },
          { "value": "outline", "label": "Outline" }
        ]},
        { "type": "select", "id": "size", "label": "Size", "default": "base", "options": [
          { "value": "sm", "label": "Small" },
          { "value": "base", "label": "Medium" },
          { "value": "lg", "label": "Large" }
        ]},
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#ffffff" },
        { "type": "color", "id": "background", "label": "Background Color", "default": "#000000" },
        { "type": "color", "id": "outline_color", "label": "Outline Color", "default": "#000000" },
        { "type": "text", "id": "icon", "label": "Icon (HTML or Unicode)" },
        { "type": "select", "id": "icon_position", "label": "Icon Position", "default": "left", "options": [
          { "value": "left", "label": "Left" },
          { "value": "right", "label": "Right" }
        ]},
        { "type": "select", "id": "alignment", "label": "Alignment", "default": "center", "options": [
          { "value": "left", "label": "Left" },
          { "value": "center", "label": "Center" },
          { "value": "right", "label": "Right" }
        ]}
      ]
    }
  ],
  "presets": [
    {
      "name": "Somos Image/Text Flex Blocks",
      "category": "Somos Custom",
      "blocks": [
        { "type": "image" },
        { "type": "title" },
        { "type": "text" },
        { "type": "button" }
      ]
    }
  ]
}
{% endschema %}

{% assign text_align = settings.alignment | default: 'center' %}
{% assign wrapper_id = section.settings.custom_id | default: 'shopify-section-' | append: section.id %}
<div class="image-text-blocks-section px-4 md:px-8 py-6 section_width_{{ section.settings.section_width }} content_{{ section.settings.section_content_width }}"
     style="
    {% if section.settings.background_gradient != blank %}background: {{ section.settings.background_gradient }};{% endif %} 
    background-color: {{ section.settings.background_color }}; 
    padding: {{ section.settings.padding_top }}px {{ section.settings.padding_right }}px {{ section.settings.padding_bottom }}px {{ section.settings.padding_left }}px; 
    margin: {{ section.settings.margin_top }}px {{ section.settings.margin_right }}px {{ section.settings.margin_bottom }}px {{ section.settings.margin_left }}px; 
    text-align: {{ text_align }};">
  
  {% for block in section.blocks %}
    {% case block.type %}

      {% when 'paragraph' %}
      <p class="itfb-paragraph mb-4" style="font-size: {{ block.settings.font_size }}px; color:{{ block.settings.text_color }}">
        {{ block.settings.text }}
      </p>

      {% when 'image' %}
        {% if block.settings.image %}
          <style>
              #{{ wrapper_id }} .image-text-blocks-section .image-block > img {
              --block-image-width: {{ block.settings.image_width | default: 100 }}%
              }

              {% if block.settings.use_mobile_width %}
                @media screen and (max-width: 749px) {   
                  #{{ wrapper_id }} .image-text-blocks-section .image-block > img {
                  --block-image-width: {{ block.settings.mobile_image_width | default: 100 }}%
                  }
                }
              {% endif %}
          </style>
          {% assign image_align = block.settings.image_alignment | default: 'center' %}
          <div class="image-block {% if section.settings.narrow_container %}page-width-container{% else %}section_content_width_{{ section.settings.section_content_width }}{% endif %}
            {% if image_align == 'left' %} justify-start
            {% elsif image_align == 'right' %} justify-end
            {% else %} justify-center
            {% endif %}
            flex mb-4">
            <img
              src="{{ block.settings.image | image_url: width: 1200 }}"
              alt="Section image"
              class="mb-4 inline-block itfb_image"
              style="width: var(--block-image-width); height: auto;"
              loading="lazy"
            />

          </div>
        {% endif %}

      {% when 'title' %}
        <h2 style="font-size:{{ block.settings.font_size }}px; color:{{ block.settings.text_color }}">{{ block.settings.title }}</h2>

      {% when 'text' %}
        <p class="desc" style="color:{{ block.settings.text_color }}">{{ block.settings.text }}</p>

        {% when 'button' %}
          <div style="text-align: {{ block.settings.alignment | default: section.settings.text_alignment }} !important; margin-top: 14px;">
            <a
              href="{{ block.settings.url }}"
              class="btn btn--{{ block.settings.size }}"
              style="
                border-radius: 30px;
                color: {{ block.settings.text_color }};
                background-color: {{ block.settings.background }};
                {% if block.settings.style == 'outline' %}
                  border: 2px solid {{ block.settings.outline_color }};
                  background-color: transparent;
                {% endif %}
              "
              {{ block.shopify_attributes }}>
              {% if block.settings.icon_position == 'left' and block.settings.icon != blank %}
                <span>{{ block.settings.icon }}</span>
              {% endif %}
              {{ block.settings.text }}
              {% if block.settings.icon_position == 'right' and block.settings.icon != blank %}
                <span>{{ block.settings.icon }}</span>
              {% endif %}
            </a>
          </div>

    {% endcase %}
  {% endfor %}
</div>

{% style %}
  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} .image-text-blocks-section {
      overflow: hidden;
    }
    #shopify-section-{{ section.id }} .image-text-blocks-section .section_content_width_standard {
      padding-inline: 0!important;
    }
  }
{% endstyle %}