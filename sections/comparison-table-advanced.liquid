{%- render 'section-spacing-collapsing' -%}

<style>
  .comparison-section .parent-categories {
    display: flex;
    justify-content: center;
    gap: 16px;
    background: #FAFAFA;
    padding: 4px 7px;
    margin: 0 auto 24px auto;
    border-radius: 9999px;
    width: fit-content;
  }

  .comparison-section .category-tab {
    padding: 8px 16px;
    border-radius: 9999px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .comparison-section .category-tab.active {
    background: #20413B;
    color: white;
  }

  .comparison-section .subcategory-tabs {
    display: flex;
    justify-content: center;
    border-bottom: 1px solid #ccc;
        margin-top: 3rem !important;
    width: 70%;
    margin: 0 auto;
  }
  

  .comparison-section .subcategory-tab {
    padding: 8px 16px;
    background: none;
    border: none;
    cursor: pointer;
    position: relative;
    font-size: 14px;
    color: #444;
    transition: color 0.3s;
  }

  .comparison-section .subcategory-tab.active {
    color: #000;
  }

  .comparison-section .subcategory-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: #000;
  }
</style>

<div class="comparison-section section_width_{{ section.settings.section_width }}" style="
  {% if section.settings.background_image != blank %}
    background-image: url({{ section.settings.background_image | image_url }});
    background-size: cover;
    background-position: center;
  {% elsif section.settings.background_color != blank %}
    background-color: {{ section.settings.background_color }};
  {% endif %}
  padding: {{ section.settings.padding_top }}px {{ section.settings.padding_right }}px {{ section.settings.padding_bottom }}px {{ section.settings.padding_left }}px; margin: {{ section.settings.margin_top }}px {{ section.settings.margin_right }}px {{ section.settings.margin_bottom }}px {{ section.settings.margin_left }}px">

  <div class="container text-{{ section.settings.text_alignment }} {{ section.settings.section_width }}">
    {% if section.settings.title != blank %}
      <h1 style="color: {{ section.settings.text_color }}; text-align: center;">
        {{ section.settings.title }}
      </h1>
    {% endif %}
    {% if section.settings.description != blank %}
      <div style="color: {{ section.settings.text_color }}; text-align: center;">
        {{ section.settings.description }}
      </div>
    {% endif %}
    {% if section.settings.button_text != blank and section.settings.button_url != blank %}
      <div style="text-align: center;">
        <a href="{{ section.settings.button_url }}" class="btn" style="color: {{ section.settings.button_text_color }}; background-color: {{ section.settings.button_background }}; font-size: {{ section.settings.button_size }}px;">
          {{ section.settings.button_text }}
        </a>
      </div>
    {% endif %}

    <!-- Category & Subcategory Filters -->
    <div class="comparison-filters" style="margin: 2rem 0; text-align: center;">
      <div class="parent-categories">
        <button class="category-tab" data-category="outdoor">Outdoor TV</button>
        <button class="category-tab" data-category="kitchen">Kitchen TV</button>
        <button class="category-tab" data-category="rv">RV TV</button>
        <button class="category-tab" data-category="bathroom">Bathroom TV</button>
        <button class="category-tab" data-category="commercial">Commercial TV</button>
      </div>
      <div class="subcategory-tabs" style="margin-top: 1rem;">
        <button class="subcategory-tab" data-subcategory="vs">Partial Sun Area VS. Full Sun Area</button>
        <button class="subcategory-tab" data-subcategory="partial">Partial Sun Area</button>
        <button class="subcategory-tab" data-subcategory="full">Full Sun Area</button>
      </div>
      <h2 id="subcategory-heading" style="margin-top: 1.5rem; text-align: center;"></h2>
    </div>

    <!-- Unified Scroll Container -->
    <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; width: 100%;">
      <div style="min-width: 768px;">

        <!-- Header Section -->
        <div class="comparison-header" style="display: grid; grid-template-columns: 120px repeat({{ section.blocks.size }}, 1fr); gap: 1rem; margin-bottom: 2rem;">
          <div class="header-blank"></div>
          {% for block in section.blocks %}
            <div class="comparison-column text-center header"
                 data-parent="{{ block.settings.parent_category_id }}"
                 data-sub="
  {% assign subs = '' %}
  {% if block.settings.subcategory_vs %}vs {% endif %}
  {% if block.settings.subcategory_partial %}partial {% endif %}
  {% if block.settings.subcategory_full %}full {% endif %}
  {{ subs | strip }}
"

                 style="display: flex; flex-direction: column; align-items: center;">
  {% if block.settings.main_image %}
    <img src="{{ block.settings.main_image | image_url: width: 300 }}" alt="Main image" style="margin: 0 auto; max-width: 100%; height: auto; margin-bottom: 1rem;" />
  {% endif %}
  {% if block.settings.header_title != blank %}
    <div class="top-title">{{ block.settings.header_title }}</div>
  {% endif %}
  {% if block.settings.icon or block.settings.title %}
    <div class="icon-title-wrapper" style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
      {% if block.settings.icon %}
        <img src="{{ block.settings.icon | image_url }}" alt="Icon" style="height: 24px;">
      {% endif %}
      {% if block.settings.title != blank %}
        <div class="top-title">{{ block.settings.title }}</div>
      {% endif %}
    </div>
  {% endif %}
  {% if block.settings.price != blank %}
    <div class="price" style="margin-top: 0.5rem;">
      {{ block.settings.price }}
    </div>
  {% endif %}
  {% if block.settings.button_label and block.settings.button_link %}
    <a href="{{ block.settings.button_link }}" class="btn mt-2" style="font-size: {{ section.settings.button_size }}px;">
      {{ block.settings.button_label }}
      {% if block.settings.button_image %}
        <img src="{{ block.settings.button_image | image_url }}" style="height: 1em; margin-left: 0.5em;" />
      {% endif %}
    </a>
  {% endif %}
</div>
          {% endfor %}
        </div>

        <!-- Table Values Section -->
        <div class="comparison-values" style="display: grid; grid-template-columns: 120px repeat({{ section.blocks.size }}, 1fr); gap: 1rem;">
          {% assign max_rows = 20 %}
          {% for i in (1..max_rows) %}
            {% assign heading_key = 'heading_' | append: i %}
            {% if section.settings[heading_key] != blank %}
              <div class="head" style="display: flex; align-items: center;">{{ section.settings[heading_key] }}</div>
              {% for block in section.blocks %}
                {% assign value_key = 'value_' | append: i %}
                {% assign image_key = 'value_image_' | append: i %}
                <div class="comparison-column text-center table-value"
                     data-parent="{{ block.settings.parent_category_id }}"
                     data-sub="{% if block.settings.subcategory_vs %}vs {% endif %}{% if block.settings.subcategory_partial %}partial {% endif %}{% if block.settings.subcategory_full %}full {% endif %}">
                  {% if block.settings[image_key] %}
                    <img src="{{ block.settings[image_key] | image_url }}" alt="Value image" style="max-width: 80%; display: block; margin: 0 auto 0.5rem;" />
                  {% endif %}
                  {% if block.settings[value_key] != blank %}
                    <div>{{ block.settings[value_key] }}</div>
                  {% else %}
                    <div>â€”</div>
                  {% endif %}
                </div>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </div>

      </div>
    </div>

<!-- JavaScript Filter Logic -->
<script>
  let activeParentCategory = 'outdoor';
  let activeSubcategories = ['vs']; // multi-select enabled

  const subcategoryLabels = {
    vs: "Partial Sun Area VS. Full Sun Area",
    partial: "Partial Sun Area",
    full: "Full Sun Area"
  };

  function updateSubcategoryHeading() {
    const labels = activeSubcategories.map(sub => subcategoryLabels[sub] || sub);
    document.getElementById("subcategory-heading").innerText = labels.join(" + ");
  }

  function updateComparison() {
    const allColumns = document.querySelectorAll(".comparison-column");
    const headerRow = document.querySelector(".comparison-header");
    const valueGrid = document.querySelector(".comparison-values");

    let visibleCount = 0;

    allColumns.forEach((column) => {
      const isHeader = column.classList.contains("header");
      const parent = column.dataset.parent;
      const subList = (column.dataset.sub || '').trim().split(/\s+/); // turns "vs partial" into ["vs", "partial"]
const shouldShow = parent === activeParentCategory && subList.some(sub => activeSubcategories.includes(sub));


      column.style.display = shouldShow ? "" : "none";
      if (shouldShow && isHeader) visibleCount++;
    });

    if (visibleCount > 0) {
      if (headerRow) {
        headerRow.style.gridTemplateColumns = `120px repeat(${visibleCount}, 1fr)`;
      }
      if (valueGrid) {
        valueGrid.style.gridTemplateColumns = `120px repeat(${visibleCount}, 1fr)`;
      }
    }

    // Update active states
    document.querySelectorAll(".category-tab").forEach((tab) => {
      tab.classList.toggle("active", tab.dataset.category === activeParentCategory);
    });

    document.querySelectorAll(".subcategory-tab").forEach((tab) => {
      tab.classList.toggle("active", activeSubcategories.includes(tab.dataset.subcategory));
    });

    updateSubcategoryHeading();
  }

  document.addEventListener("DOMContentLoaded", () => {
    // Category tab click
    document.querySelectorAll(".category-tab").forEach((button) => {
      button.addEventListener("click", () => {
        activeParentCategory = button.dataset.category;
        updateComparison();
      });
    });

    // Subcategory multi-select click
    document.querySelectorAll(".subcategory-tab").forEach((button) => {
      button.addEventListener("click", () => {
        const sub = button.dataset.subcategory;
        if (activeSubcategories.includes(sub)) {
          activeSubcategories = activeSubcategories.filter(s => s !== sub);
        } else {
          activeSubcategories.push(sub);
        }
        updateComparison();
      });
    });

    updateComparison();
  });
</script>




  </div>
</div>


{% schema %}
{
  "name": "Comparison Table Advanced",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color"
    },
    {
      "type": "color",
      "id": "button_background",
      "label": "Button Background Color"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color"
    },
    {
      "type": "range",
      "id": "button_size",
      "label": "Button Font Size",
      "min": 10,
      "max": 30,
      "default": 16
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background Image"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "default": "standard",
      "options": [
        {
          "value": "standard",
          "label": "50% Width"
        },
        {
          "value": "full",
          "label": "Full Width"
        }
      ]
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text Alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_left",
      "label": "Padding Left",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_right",
      "label": "Padding Right",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin Top",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin Bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_left",
      "label": "Margin Left",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_right",
      "label": "Margin Right",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 0
    },
    {
      "type": "text",
      "id": "view_all_text",
      "label": "View All Comparisons Text",
      "default": "View All Comparisons"
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "View All Comparisons URL"
    },
    {
      "type": "image_picker",
      "id": "view_all_icon",
      "label": "Icon for View All Comparisons"
    },
    {
  "type": "checkbox",
  "id": "show_view_all_comparisons",
  "label": "Show 'View All Comparisons' Link",
  "default": true
},
{
  "type": "checkbox",
  "id": "show_see_all_specs",
  "label": "Show 'See All Specs' Toggle",
  "default": true
},
{
  "type": "image_picker",
  "id": "arrow_icon_down",
  "label": "Arrow Down Icon (See All Specs)"
},
    {
      "type": "header",
      "content": "Row Headings"
    },
    { "type": "text", "id": "heading_1", "label": "Heading 1" },
    { "type": "text", "id": "heading_2", "label": "Heading 2" },
    { "type": "text", "id": "heading_3", "label": "Heading 3" },
    { "type": "text", "id": "heading_4", "label": "Heading 4" },
    { "type": "text", "id": "heading_5", "label": "Heading 5" },
    { "type": "text", "id": "heading_6", "label": "Heading 6" },
    { "type": "text", "id": "heading_7", "label": "Heading 7" },
    { "type": "text", "id": "heading_8", "label": "Heading 8" },
    { "type": "text", "id": "heading_9", "label": "Heading 9" },
    { "type": "text", "id": "heading_10", "label": "Heading 10" },
    { "type": "text", "id": "heading_11", "label": "Heading 11" },
    { "type": "text", "id": "heading_12", "label": "Heading 12" },
    { "type": "text", "id": "heading_13", "label": "Heading 13" },
    { "type": "text", "id": "heading_14", "label": "Heading 14" },
    { "type": "text", "id": "heading_15", "label": "Heading 15" },
    { "type": "text", "id": "heading_16", "label": "Heading 16" },
    { "type": "text", "id": "heading_17", "label": "Heading 17" },
    { "type": "text", "id": "heading_18", "label": "Heading 18" },
    { "type": "text", "id": "heading_19", "label": "Heading 19" },
    { "type": "text", "id": "heading_20", "label": "Heading 20" }
  ],
  "blocks": [
    {
      "type": "values",
      "name": "Column",
      "settings": [
        {
          "type": "select",
          "id": "parent_category_id",
          "label": "Parent Category",
          "default": "outdoor",
          "options": [
            { "value": "outdoor", "label": "Outdoor TV" },
            { "value": "kitchen", "label": "Kitchen TV" },
            { "value": "rv", "label": "RV TV" },
            { "value": "bathroom", "label": "Bathroom TV" },
            { "value": "commercial", "label": "Commercial TV" }
          ]
        },
        {
  "type": "checkbox",
  "id": "subcategory_vs",
  "label": "Partial Sun Area VS. Full Sun Area",
  "default": false
},
{
  "type": "checkbox",
  "id": "subcategory_partial",
  "label": "Partial Sun Area",
  "default": false
},
{
  "type": "checkbox",
  "id": "subcategory_full",
  "label": "Full Sun Area",
  "default": false
},
        { "type": "image_picker", "id": "main_image", "label": "Main Image" },
        { "type": "text", "id": "header_title", "label": "Product Name" },
        { "type": "image_picker", "id": "icon", "label": "Icon beside title" },
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "text", "id": "price", "label": "Price Text" },
        { "type": "text", "id": "button_label", "label": "Button Label" },
        { "type": "url", "id": "button_link", "label": "Button URL" },
        { "type": "image_picker", "id": "button_image", "label": "Button Image" },
        { "type": "richtext", "id": "value_1", "label": "Value 1" },
        { "type": "image_picker", "id": "value_image_1", "label": "Image above Value 1" },
        { "type": "richtext", "id": "value_2", "label": "Value 2" },
        { "type": "image_picker", "id": "value_image_2", "label": "Image above Value 2" },
        { "type": "richtext", "id": "value_3", "label": "Value 3" },
        { "type": "image_picker", "id": "value_image_3", "label": "Image above Value 3" },
        { "type": "richtext", "id": "value_4", "label": "Value 4" },
        { "type": "image_picker", "id": "value_image_4", "label": "Image above Value 4" },
        { "type": "richtext", "id": "value_5", "label": "Value 5" },
        { "type": "image_picker", "id": "value_image_5", "label": "Image above Value 5" },
        { "type": "richtext", "id": "value_6", "label": "Value 6" },
        { "type": "image_picker", "id": "value_image_6", "label": "Image above Value 6" },
        { "type": "richtext", "id": "value_7", "label": "Value 7" },
        { "type": "image_picker", "id": "value_image_7", "label": "Image above Value 7" },
        { "type": "richtext", "id": "value_8", "label": "Value 8" },
        { "type": "image_picker", "id": "value_image_8", "label": "Image above Value 8" },
        { "type": "richtext", "id": "value_9", "label": "Value 9" },
        { "type": "image_picker", "id": "value_image_9", "label": "Image above Value 9" },
        { "type": "richtext", "id": "value_10", "label": "Value 10" },
        { "type": "image_picker", "id": "value_image_10", "label": "Image above Value 10" }
      ]
    }
  ],
  "presets": [
    {
  "name": "Comparison Table Advanced",
      "blocks": []
    }
  ]
}
{% endschema %}

