{% comment %}
  Media Logo Carousel | Dots for groups of 4 + drag to scroll
{% endcomment %}
<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">

<div class="media-logo-carousel section_width_{{ section.settings.section_width }}" id="media-logo-carousel-{{ section.id }}">
  <div class="media-logo-carousel__inner section_content_width_{{ section.settings.section_content_width }}">
    <div class="media-logo-carousel__text-group align-{{ section.settings.title_alignment }}">
      <h2 class="media-logo-carousel__heading">{{ section.settings.heading }}</h2>
      <p class="media-logo-carousel__subtext">{{ section.settings.subtext }}</p>
    </div>
    <div class="media-logo-carousel__carousel">
      {% for block in section.blocks %}
        <div class="media-logo-carousel__item" data-index="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
          <div class="media-logo-carousel__logo-wrapper">
            {% if block.settings.logo != blank %}
              <img 
                src="{{ block.settings.logo | image_url }}" 
                loading="lazy"
                alt="{{ block.settings.alt }}"
                class="media-logo-carousel__logo"
              >
            {% endif %}
          </div>
          <p class="media-logo-carousel__meta">{{ block.settings.description }}</p>
        </div>
      {% endfor %}
    </div>
  {% if section.settings.show_dots %}
    <div class="media-logo-carousel__dots">
    
    </div>
  {% endif %}


  </div>

  {% style %}
    .media-logo-carousel {
      position: relative;
      overflow: hidden;
      padding: 80px 40px;
      background-image: url({{ section.settings.background | image_url }});
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .media-logo-carousel__inner {
      max-width: 1608px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    

    .media-logo-carousel__text-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 40px;
    }

    .media-logo-carousel__text-group.align-left {
      text-align: left;
      align-items: flex-start;
    }

    .media-logo-carousel__text-group.align-center {
      text-align: center;
      align-items: center;
    }

    .media-logo-carousel__text-group.align-right {
      text-align: right;
      align-items: flex-end;
    }

    .media-logo-carousel__heading {
      line-height: 1.2;
      margin: 0;
      color: #000000;
    }

    .media-logo-carousel__subtext {
      font-family: Roboto, sans-serif;
      font-size: 16px;
      font-weight: 400;
      max-width: 600px;
      line-height: 1.5;
      color: #000000;
    }

    .media-logo-carousel__carousel {
       display: flex;   
       flex-wrap: nowrap;
       overflow: hidden;
       opacity: 0;
        gap: 0 !important;             
        scroll-snap-type: none !important;
        scroll-behavior: auto !important;
        cursor: grab; /* optional: keep the grab cursor */
        transition: 200ms;
    }

    .media-logo-carousel__carousel.flickity-enabled {
      opacity: 1;
      display: block;
    }

    .media-logo-carousel__item {
      flex: 0 0 auto;
      background-color: #ffffff;
      color: #1D1D1B;
      border-radius: 8px;
      scroll-snap-align: start;
      opacity: 1;
      transition: opacity 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 60px;
      width: 20%;
    }

    .media-logo-carousel__item.active {
      opacity: 1;
    }

    .media-logo-carousel__quote {
      font-family: Roboto, sans-serif;
      font-size: 18px;
      line-height: 1.5;
      margin-bottom: 32px;
    }

    .media-logo-carousel__logo-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      width: fit-content;
      max-width: 60%;
    }

    .media-logo-carousel__logo {
      display: flex;
      justify-content: center;
      align-items: center;
      max-height: 100%;
    }
    @media (max-width: 768px) {
      .media-logo-carousel__logo {
        max-width: 80%;
        width: 100% !important;
      }
      .media-logo-carousel__inner.section_content_width_standard {
        adding-left: 0px !important;
        padding-right: 0px !important;
      }
    }

    .media-logo-carousel__meta {
      font-size: 14px;
      text-align: center;
      color: #7e8182;
    }

    .media-logo-carousel__dots {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .media-logo-carousel__dots .dot {
      height: 12px;
      width: 12px;
      margin: 0 4px;
      background-color: #ddd;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .media-logo-carousel__dots .dot.active {
      background-color: #e91e63;
    }

    @media screen and (max-width: 768px) {

     .media-logo-carousel {
        padding: 60px 20px;
      }

      .media-logo-carousel__carousel {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        overflow: visible;
        scroll-snap-type: none;
        cursor: default;
      }

      .media-logo-carousel__item {
        width: 30%;
        opacity: 1;
      }
      .media-logo-carousel__logo-wrapper {
        max-width: 90%;
      }
    }
  {% endstyle %}

<script>
document.addEventListener("DOMContentLoaded", function() {
  const carousels = document.querySelectorAll('.media-logo-carousel');

  // Simple debounce helper
  function debounce(fn, delay) {
    let timeout;
    return function(...args) {
      clearTimeout(timeout);
      timeout = setTimeout(() => fn.apply(this, args), delay);
    };
  }

  carousels.forEach(section => {
    const carouselEl = section.querySelector('.media-logo-carousel__carousel');
    const dotsContainer = section.querySelector('.media-logo-carousel__dots');

    if (!carouselEl || !dotsContainer) return;

    // Initialize Flickity
    const flkty = new Flickity(carouselEl, {
      cellAlign: 'left',
      contain: true,
      pageDots: false,        
      prevNextButtons: false,
      groupCells: 4,      
      draggable: true,
      wrapAround: true
    });

    // Build dots dynamically based on number of groups
    function buildDots() {
      dotsContainer.innerHTML = '';
      flkty.slides.forEach((slide, i) => {
        const dot = document.createElement('span');
        dot.className = 'dot' + (i === flkty.selectedIndex ? ' active' : '');
        dot.dataset.group = i;
        dot.addEventListener('click', () => flkty.select(i));
        dotsContainer.appendChild(dot);
      });
    }

    // Update active dot
    function updateActiveDot(index) {
      const dots = dotsContainer.querySelectorAll('.dot');
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });
    }

    // Initial dots
    buildDots();

    // Sync dots on change
    flkty.on('change', updateActiveDot);

    // Rebuild dots on resize (debounced to avoid too many calls)
    flkty.on('resize', debounce(() => {
      buildDots();
    }, 200));
  });
});
</script>


</div>

{% schema %}
{
  "name": "Media Logo Carousel",
  "tag": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "background",
      "label": "Background image"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "As seen on"
    },
    {
      "type": "text",
      "id": "subtext",
      "label": "Subtext",
      "default": "Our brand has been featured in some of the most trusted media outlets, showcasing our commitment to quality and innovation."
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section Width",
      "default": "standard",
      "options": [
        { "value": "standard", "label": "50% Width" },
        { "value": "full", "label": "Full Width" }
      ]
    },
    {
      "type": "select",
      "id": "section_content_width",
      "label": "Content Width",
      "default": "standard",
      "options": [
        { "value": "standard", "label": "50% Width" },
        { "value": "full", "label": "Full Width" }
      ]
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
  "type": "checkbox",
  "id": "show_dots",
  "label": "Show Dots",
  "default": true
}
  ],
  "blocks": [
    {
      "type": "media_item",
      "name": "Media Item",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "“The low-profile form factor, excellent video quality and ease of use make it a winner.”"
        },
        {
          "type": "image_picker",
          "id": "logo",
          "label": "Logo image"
        },
        {
          "type": "number",
          "id": "logo_width",
          "label": "Logo width (%)",
          "default": 50
        },
        {
          "type": "text",
          "id": "alt",
          "label": "Logo alt text",
          "default": "Media logo"
        },
        {
          "type": "text",
          "id": "description",
          "label": "Description",
          "default": "By William Roberson, Sep 28, 2020"
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Media Logo Carousel",
      "category": "Custom",
      "blocks": [
        { "type": "media_item" },
        { "type": "media_item" },
        { "type": "media_item" }
      ]
    }
  ]
}
{% endschema %}
