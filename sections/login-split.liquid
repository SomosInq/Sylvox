{% comment %}
  Login — Split Layout with Social Login Blocks (inline)
{% endcomment %}

<style>
  .login-wrapper{display:flex;min-height:100vh}
  .login-image{flex:1;background-size:cover;background-position:center;position:relative}
  .login-image::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,0)}
  .login-form-wrapper{flex:1;display:flex;align-items:center;justify-content:center;padding:48px 32px;background:#fff}
  .login-form-wrapper .page-width{width:100%;max-width:420px}
  .login-form-wrapper .section-header__title{margin-bottom:18px}
  .login-actions{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .login-actions a{font-size:.9rem}
  .btn--primary{width:100%}
  @media (max-width:990px){.login-wrapper{flex-direction:column}.login-image{height:260px}}

  /* Social area */
  .social-inline{display:flex;align-items:center;gap:14px;margin:18px 0}
  .social-inline__label{white-space:nowrap;font-size:.95rem;color:#374151}
  .social-row{display:flex;gap:14px;flex-wrap:wrap;align-items:center}
  .social-circle{width:44px;height:44px;border:1px solid #e5e7eb;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;background:#fff;text-decoration:none}
  .social-circle:hover{border-color:#d1d5db}
  .social-circle img{max-width:24px;max-height:24px;display:block;height:auto}
  .social-pill{display:inline-flex;align-items:center;border:1px solid #e5e7eb;border-radius:999px;padding:8px 12px;height:44px;text-decoration:none;background:#fff}
  .social-pill:hover{border-color:#d1d5db}
  .social-pill img{max-width:20px;max-height:20px;display:block;height:auto}
  .social-pill .social-label{font-size:.95rem}
  .social-divider-line{height:1px;background:#f0f0f0;margin:14px 0;border:0}
  .third-party-notice{color:#6b7280;font-size:.95rem;line-height:1.5}
  .third-party-notice a{text-decoration:underline}
  @media (max-width:600px){.social-inline{flex-direction:column;align-items:flex-start;gap:10px}}
</style>

<div class="login-wrapper">
  <div
    class="login-image"
    style="
      {% if section.settings.login_image != blank %}
        background-image: url({{ section.settings.login_image | image_url: width: 2000 }});
      {% else %}
        background-image: url({{ 'placeholder-image.jpg' | asset_url }});
      {% endif %}
    "
    aria-hidden="true"
  >
    {% if section.settings.show_logo and section.settings.logo != blank %}
      <img
        src="{{ section.settings.logo | image_url: width: 300 }}"
        alt="{{ shop.name }}"
        style="position:absolute;left:24px;bottom:24px;max-width:160px;height:auto"
        loading="lazy"
      >
    {% endif %}
  </div>

  <div class="login-form-wrapper">
    <div class="page-width page-width--tiny page-content">
      <header class="section-header">
        <h1 class="section-header__title">
          {% render 't_with_fallback', key: 'actions.login', fallback: 'Log in' %}
        </h1>
      </header>

      <div class="note note--success hide" id="ResetSuccess">
        {% render 't_with_fallback',
          key: 'info.recovery_email_sent',
          fallback: "We've sent you an email with a link to update your password."
        %}
      </div>

      <!-- Login form -->
      <div id="CustomerLoginForm" class="form-vertical">
        {%- form 'customer_login' -%}
          {{ form.errors | default_errors }}

          <label for="CustomerEmail">
            {% render 't_with_fallback', key: 'labels.email', fallback: 'Email address' -%}
          </label>
          <input
            type="email"
            name="customer[email]"
            id="CustomerEmail"
            class="input-full{% if form.errors contains 'email' %} error{% endif %}"
            autocorrect="off"
            autocapitalize="off"
            {% if section.settings.autofocus %}autofocus{% endif %}
          >

          {%- if form.password_needed -%}
            <div class="login-actions">
              <label for="CustomerPassword" style="margin:0;">
                {% render 't_with_fallback', key: 'labels.password', fallback: 'Password' -%}
              </label>
              <a href="#recover" id="RecoverPassword">
                {% render 't_with_fallback', key: 'actions.forgot_password', fallback: 'Forgot your password?' %}
              </a>
            </div>

            <input
              type="password"
              name="customer[password]"
              id="CustomerPassword"
              class="input-full{% if form.errors contains 'password' %} error{% endif %}"
            >
          {%- endif -%}

          <p>
            <button type="submit" class="btn btn--full btn--primary" style="background:#184E41;">
              {{ section.settings.login_button_text | default: 'LOG IN' }}
            </button>
          </p>

          {%- assign enabled_social_blocks = 0 -%}
          {%- for block in section.blocks -%}
            {%- if block.type == 'social_login' and block.settings.enabled -%}
              {%- assign enabled_social_blocks = enabled_social_blocks | plus: 1 -%}
            {%- endif -%}
          {%- endfor -%}
          {%- assign has_widget = false -%}
          {%- if section.settings.social_widget_html != blank -%}
            {%- assign has_widget = true -%}
          {%- endif -%}
          {%- assign show_social = false -%}
          {%- if has_widget -%}{%- assign show_social = true -%}{%- endif -%}
          {%- if enabled_social_blocks > 0 -%}{%- assign show_social = true -%}{%- endif -%}

          {% if show_social %}
            <div class="social-inline">
              <span class="social-inline__label">
                {{ section.settings.or_login_with_label | default: 'Or log in with' }}
              </span>

              {% if has_widget %}
                <div class="social-row">
                  {{ section.settings.social_widget_html }}
                </div>
              {% else %}
                <div class="social-row">
                  {% for block in section.blocks %}
                    {% if block.type == 'social_login' and block.settings.enabled %}
                      {% if block.settings.show_label %}
                        <a class="social-pill" href="{{ block.settings.url | default: '#' }}" {{ block.shopify_attributes }}>
                          {% if block.settings.icon != blank %}
                            <img
                              src="{{ block.settings.icon | image_url: width: 200 }}"
                              alt="{{ block.settings.alt | escape }}"
                              style="max-height: {{ block.settings.image_height }}px; width: auto"
                              loading="lazy"
                            >
                          {% endif %}
                          <span class="social-label">{{ block.settings.label }}</span>
                        </a>
                      {% else %}
                        <a class="social-circle" href="{{ block.settings.url | default: '#' }}" {{ block.shopify_attributes }}>
                          {% if block.settings.icon != blank %}
                            <img
                              src="{{ block.settings.icon | image_url: width: 200 }}"
                              alt="{{ block.settings.alt | escape }}"
                              loading="lazy"
                            >
                          {% endif %}
                        </a>
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <hr class="social-divider-line">

          <p style="margin:0 0 12px 0;">
            {% render 't_with_fallback', key: 'info.no_account_question', fallback: "Don't have an account?" %}
            <a href="{{ routes.account_register_url }}">
              {% render 't_with_fallback', key: 'actions.create_account', fallback: 'Create an account' -%}
            </a>
          </p>

            {% if section.settings.show_third_party_notice %}
              <p class="third-party-notice">
                {{ section.settings.third_party_prefix | default: 'By logging in with a third party, it means you have read and agreed with our' }}
                {% if section.settings.privacy_link != blank %}
                  <a href="{{ section.settings.privacy_link }}">{{ section.settings.privacy_text | default: 'Privacy Policy' }}</a>
                {% else %}
                  {{ section.settings.privacy_text | default: 'Privacy Policy' }}
                {% endif %}
                {{ section.settings.third_party_middle | default: ',' }}
                {% if section.settings.terms_link != blank %}
                  <a href="{{ section.settings.terms_link }}">{{ section.settings.terms_text | default: 'Terms of Service' }}</a>
                {% else %}
                  {{ section.settings.terms_text | default: 'Terms of Service' }}
                {% endif %}.
              </p>
            {% endif %}
          {% endif %}

          {% if section.settings.password_free_url != blank %}
            <p style="margin:12px 0 0 0;">
              <a href="{{ section.settings.password_free_url }}">
                {{ section.settings.password_free_label | default: 'Password-free log in' }}
              </a>
            </p>
          {% endif %}
        {%- endform -%}
      </div>

      <!-- Recover password form -->
      <div id="RecoverPasswordForm" class="hide">
        <div class="form-vertical">
          <h2>{% render 't_with_fallback', key: 'actions.reset_your_password', fallback: 'Reset your password' %}</h2>
          <p>{% render 't_with_fallback', key: 'info.email_to_reset_password', fallback: 'We will send you an email to reset your password.' %}</p>

          {%- form 'recover_customer_password' -%}
            {{ form.errors | default_errors }}
            {%- if form.posted_successfully? -%}<span class="hide reset-password-success"></span>{%- endif -%}

            <label for="RecoverEmail">{% render 't_with_fallback', key: 'labels.email', fallback: 'Email' -%}</label>
            <input type="email" name="email" id="RecoverEmail" class="input-full" autocorrect="off" autocapitalize="off">

            <p><button type="submit" class="btn">{% render 't_with_fallback', key: 'actions.submit', fallback: 'Submit' %}</button></p>
            <button type="button" id="HideRecoverPasswordLink">{% render 't_with_fallback', key: 'actions.cancel', fallback: 'Cancel' %}</button>
          {%- endform -%}
        </div>
      </div>

      {%- if shop.checkout.guest_login -%}
        <hr class="hr--clear">
        <h2>{% render 't_with_fallback', key: 'actions.continue_as_guest', fallback: 'Continue as a guest' %}</h2>
        {%- form 'guest_login' -%}
          <button type="submit" class="btn">{% render 't_with_fallback', key: 'actions.continue', fallback: 'Continue' %}</button>
        {%- endform -%}
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  document.addEventListener('click', function(e){
    const rec = document.getElementById('RecoverPassword');
    const hide = document.getElementById('HideRecoverPasswordLink');
    if (rec && e.target === rec) {
      e.preventDefault();
      document.getElementById('CustomerLoginForm').classList.add('hide');
      document.getElementById('RecoverPasswordForm').classList.remove('hide');
    }
    if (hide && e.target === hide) {
      e.preventDefault();
      document.getElementById('RecoverPasswordForm').classList.add('hide');
      document.getElementById('CustomerLoginForm').classList.remove('hide');
    }
  });
</script>

{% schema %}
{
  "name": "Login — Split Layout",
  "max_blocks": 8,
  "settings": [
    { "type": "image_picker", "id": "login_image", "label": "Left side image" },
    { "type": "checkbox", "id": "show_logo", "label": "Show logo on image", "default": false },
    { "type": "image_picker", "id": "logo", "label": "Logo (optional)" },
    { "type": "checkbox", "id": "autofocus", "label": "Autofocus email field", "default": true },

    { "type": "text", "id": "login_button_text", "label": "Login button text", "default": "LOG IN" },

    { "type": "header", "content": "Social login" },
    { "type": "text", "id": "or_login_with_label", "label": "Inline label", "default": "Or log in with" },
    { "type": "textarea", "id": "social_widget_html", "label": "Social login widget (optional)", "info": "If your app gives you a widget/code snippet, paste it here. If present, it will replace the buttons below." },

    { "type": "header", "content": "Password-free login" },
    { "type": "url", "id": "password_free_url", "label": "Password-free login URL" },
    { "type": "text", "id": "password_free_label", "label": "Password-free link text", "default": "Password-free log in" },

    { "type": "header", "content": "Third-party notice" },
    { "type": "checkbox", "id": "show_third_party_notice", "label": "Show third-party notice", "default": true },
    { "type": "text", "id": "third_party_prefix", "label": "Notice prefix", "default": "By logging in with a third party, it means you have read and agreed with our" },
    { "type": "text", "id": "privacy_text", "label": "Privacy Policy text", "default": "Privacy Policy" },
    { "type": "url", "id": "privacy_link", "label": "Privacy Policy link" },
    { "type": "text", "id": "third_party_middle", "label": "Text between Privacy and Terms", "default": "," },
    { "type": "text", "id": "terms_text", "label": "Terms text", "default": "Terms of Service" },
    { "type": "url", "id": "terms_link", "label": "Terms link" }
  ],
  "blocks": [
    {
      "type": "social_login",
      "name": "Social login",
      "settings": [
        { "type": "checkbox", "id": "enabled", "label": "Enable this social login", "default": true },
        { "type": "image_picker", "id": "icon", "label": "Icon image" },
        { "type": "range", "id": "image_height", "label": "Icon max height (px)", "min": 12, "max": 48, "step": 2, "default": 24 },
        { "type": "text", "id": "label", "label": "Label (e.g., Google)" },
        { "type": "checkbox", "id": "show_label", "label": "Show label next to icon", "default": false },
        { "type": "url", "id": "url", "label": "Login URL (from your app/IdP)" },
        { "type": "text", "id": "alt", "label": "Icon alt text", "default": "Social login" }
      ]
    }
  ]
}
{% endschema %}
