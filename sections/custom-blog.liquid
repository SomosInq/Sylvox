{{ 'https://cdnjs.cloudflare.com/ajax/libs/flickity/2.3.0/flickity.min.css' | stylesheet_tag }}
{{ 'https://cdnjs.cloudflare.com/ajax/libs/flickity/2.3.0/flickity.pkgd.min.js' | script_tag }}

<section class="custom-blog" style="background: {{ section.settings.bg_color }};">
  {% assign featured_article = blog.articles.first %}
  {% assign override_img = section.settings.custom_banner_override_image %}

  <!-- Banner -->
  <div class="custom-blog__banner" style="background-image: url('{{ override_img | default: featured_article.image | image_url: width: 2000 }}');">
    <div class="custom-blog__banner-inner">
      <div class="custom-blog__label">
        {{ section.settings.banner_label | default: featured_article.tags.first }}
      </div>
      <div class="custom-blog__subtitle">
        {{ section.settings.banner_subtitle | default: featured_article.author }}
      </div>
      <h1 class="custom-blog__heading">
        {{ section.settings.custom_banner_title | default: featured_article.title }}
      </h1>
      <a href="{{ featured_article.url }}" class="custom-blog__arrow">
        {% render 'diagonal-bottom-left-arrow.svg' %}
      </a>
    </div>
  </div>

  <!-- Slider -->
  <div class="custom-blog__slider-wrapper">
    <div class="custom-blog__slider js-flickity"
         data-flickity='{
           "wrapAround": true,
           "pageDots": true,
           "prevNextButtons": false,
           "cellAlign": "left",
           "contain": true
         }'>
      {% for article in blog.articles limit: 6 %}
        <div class="custom-blog__slider-item">
          <a href="{{ article.url }}" class="custom-blog__slider-card">
            {% if article.image %}
              <img src="{{ article.image | image_url: width: 600 }}" alt="{{ article.title }}">
            {% endif %}
            <div class="custom-blog__slider-caption">
              <span class="custom-blog__slider-date">{{ article.published_at | date: "%B %d, %Y" }}</span>
              <h3 class="custom-blog__slider-title">{{ article.title }}</h3>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>

    <div class="custom-blog__slider-controls">
      <div class="custom-blog__dots"></div>
      <div class="custom-blog__arrows">
        <button class="custom-blog__prev" aria-label="Previous">&lt;</button>
        <button class="custom-blog__next" aria-label="Next">&gt;</button>
      </div>
    </div>
  </div>

  <!-- Blog List Title -->
  <h2 class="custom-blog__list-title" style="text-align:center; margin-top: 40px;">
    {{ section.settings.blog_list_title }}
  </h2>

  <!-- Filter/Sort Row -->
  <div class="custom-blog__filter-sort">
    <button class="custom-blog__filter-btn">Filter</button>
    <button class="custom-blog__sort-btn">Sort</button>
  </div>

  {% paginate blog.articles by 9 %}
    <!-- Blog Grid -->
    <div class="custom-blog__grid">
      {% for article in blog.articles %}
        <div class="custom-blog__card" data-category="{{ article.tags | join: ' ' }}">
          <div class="custom-blog__card-image">
            {% if article.image %}
              <a href="{{ article.url }}">
                <img src="{{ article.image | image_url: width: 600 }}" alt="{{ article.title }}">
              </a>
            {% else %}
              <div class="custom-blog__image-placeholder"></div>
            {% endif %}
            {% if article.tags.size > 0 %}
              <div class="custom-blog__card-label">{{ article.tags.first }}</div>
            {% endif %}
          </div>

          <div class="custom-blog__card-content">
            <h3 class="custom-blog__card-title">
              <a href="{{ article.url }}">{{ article.title }}</a>
            </h3>
            <div class="custom-blog__card-excerpt-arrow">
              <p class="custom-blog__card-excerpt">
                {{ article.excerpt_or_content | strip_html | truncate: 140 }}
              </p>
              <a class="custom-blog__card-arrow" href="{{ article.url }}">
                {% render 'diagonal-bottom-left-arrow.svg' %}
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="custom-blog__pagination">
      {% if paginate.previous %}
        <a href="{{ paginate.previous.url }}">&lt;</a>
      {% endif %}
      {% for part in paginate.parts %}
        {% if part.is_link %}
          <a href="{{ part.url }}">{{ part.title }}</a>
        {% else %}
          <span class="current">{{ part.title }}</span>
        {% endif %}
      {% endfor %}
      {% if paginate.next %}
        <a href="{{ paginate.next.url }}">&gt;</a>
      {% endif %}
    </div>
  {% endpaginate %}
</section>

{% schema %}
{
  "name": "Custom Blog",
  "tag": "section",
  "class": "custom-blog",
  "settings": [
    {
      "type": "image_picker",
      "id": "custom_banner_override_image",
      "label": "Override Banner Image (optional)"
    },
    {
      "type": "text",
      "id": "custom_banner_title",
      "label": "Custom Banner Title (optional)"
    },
    {
      "type": "text",
      "id": "banner_label",
      "label": "Banner Label",
      "default": "News"
    },
    {
      "type": "text",
      "id": "banner_subtitle",
      "label": "Banner Subtitle",
      "default": "Author Name"
    },
    {
      "type": "url",
            "banner_link",
      "label": "Banner Link"
    },
    {
      "type": "text",
      "id": "blog_list_title",
      "label": "Blog List Section Title",
      "default": "More Articles"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Custom Blog",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% style %}
/* Slider + Dots + Arrows */
.custom-blog__slider-wrapper {
  position: relative;
  max-width: 1600px;
  margin: 60px auto 80px;
}

.custom-blog__slider {
  margin-bottom: 40px;
}

.custom-blog__slider-item {
  width: 100%;
  max-width: 519.98px;
  background: #fff;
  border-radius: 4px;
  overflow: hidden;
  display: flex;
  flex-direction: row;
  gap: 20px;
}

.custom-blog__slider-item img {
  width: 50%;
  height: auto;
  object-fit: cover;
}

.custom-blog__slider-caption {
  padding: 20px;
  background: #FAFAFA;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
}

.custom-blog__slider-date {
  font-size: 12px;
  color: #777;
}

.custom-blog__slider-title {
  font-size: 18px;
  font-weight: 500;
  color: #1D1D1B;
  line-height: 1.4;
}

.custom-blog__slider-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  max-width: 1600px;
  margin: 0 auto;
  padding: 0 12px;
}

.custom-blog__dots .dot {
  width: 24px;
  height: 2px;
  background: rgba(0, 0, 0, 0.2);
  margin: 0 6px;
  border-radius: 2px;
  display: inline-block;
  transition: all 0.3s ease;
}

.custom-blog__dots .dot.is-selected {
  background: #DB4B97;
  width: 48px;
}

.custom-blog__arrows {
  display: flex;
  gap: 12px;
}

.custom-blog__arrows button {
  width: 32px;
  height: 32px;
  border: 1px solid #999;
  background: transparent;
  border-radius: 9999px;
  font-size: 16px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

@media screen and (max-width: 767px) {
  .custom-blog__slider-item {
    flex-direction: column;
  }

  .custom-blog__slider-item img {
    width: 100%;
  }

  .custom-blog__slider-controls {
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  .custom-blog__arrows {
    justify-content: center;
  }
}
{% endstyle %}

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var slider = document.querySelector('.custom-blog__slider');
    if (slider) {
      var flkty = new Flickity(slider, {
        wrapAround: true,
        cellAlign: 'left',
        pageDots: true,
        prevNextButtons: false,
        contain: true
      });

      var prevBtn = document.querySelector('.custom-blog__prev');
      var nextBtn = document.querySelector('.custom-blog__next');
      var dotsWrapper = document.querySelector('.custom-blog__dots');

      flkty.on('ready', function() {
        var dots = slider.querySelector('.flickity-page-dots');
        if (dotsWrapper && dots) {
          dotsWrapper.appendChild(dots);
        }
      });

      if (prevBtn && nextBtn) {
        prevBtn.addEventListener('click', function() {
          flkty.previous();
        });
        nextBtn.addEventListener('click', function() {
          flkty.next();
        });
      }
    }
  });
</script>

