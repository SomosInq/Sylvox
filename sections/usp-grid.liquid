{% schema %}
{
  "name": "USP Grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Sylvox’s exclusive advantages"
    },
    {
      "type": "textarea",
      "id": "subtext",
      "label": "Subtext Below Heading",
      "default": "Explore our core benefits below"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "default": "center",
      "options": [
        { "label": "Left", "value": "left" },
        { "label": "Center", "value": "center" },
        { "label": "Right", "value": "right" }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show Navigation Arrows",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "usp_item",
      "name": "USP Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon Image"
        },
        {
          "type": "select",
          "id": "image_size",
          "label": "Icon Size",
          "default": "medium",
          "options": [
            { "label": "Small", "value": "small" },
            { "label": "Medium", "value": "medium" },
            { "label": "Large", "value": "large" }
          ]
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Authenticity Guarantee"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "100% Genuine, Quality Assured"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Box Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "USP Grid",
      "category": "Somos Custom"
    }
  ]
}
{% endschema %}

<section class="usp-grid-section">
  {% if section.settings.heading != blank %}
    <div class="usp-heading-wrapper" style="text-align: {{ section.settings.heading_alignment }};">
      <h2 class="usp-heading">{{ section.settings.heading }}</h2>
      {% if section.settings.subtext != blank %}
        <div class="usp-subtext">{{ section.settings.subtext }}</div>
      {% endif %}
    </div>
  {% endif %}

  <div class="usp-slider-wrapper">
    {% if section.settings.show_arrows %}
      <div class="usp-arrows">
        <button class="usp-arrow prev" aria-label="Previous">‹</button>
        <button class="usp-arrow next" aria-label="Next">›</button>
      </div>
    {% endif %}

    <div 
      class="usp-slider js-flickity" 
      data-flickity='{
        "wrapAround": true,
        "pageDots": false,
        "contain": true,
        "prevNextButtons": false,
        "cellAlign": "left"
      }'>

      {% for block in section.blocks %}
        {% assign size_class = block.settings.image_size %}
        <a href="{{ block.settings.link | default: '#' }}" class="usp-box carousel-cell" {{ block.shopify_attributes }}>
          <div class="usp-inner">
            {% if block.settings.icon %}
              <img 
                src="{{ block.settings.icon | img_url: '150x150' }}" 
                alt="{{ block.settings.title }}" 
                class="usp-icon {{ size_class }}">
            {% endif %}
            <h3 class="usp-title">{{ block.settings.title }}</h3>
            <p class="usp-text">{{ block.settings.text }}</p>
          </div>
        </a>
      {% endfor %}
    </div>
  </div>
</section>

<style>
.usp-grid-section {
  padding: 2rem;
}
.usp-heading-wrapper {
  margin-bottom: 1rem;
}
.usp-heading {
  font-size: 1.75rem;
  margin-bottom: 0.5rem;
}
.usp-subtext {
  font-size: 1rem;
  color: #555;
}
.usp-slider-wrapper {
  position: relative;
}
.usp-slider {
  overflow: hidden;
}
.carousel-cell {
  width: 240px;
  margin-right: 16px;
}
.usp-box {
  display: block;
  background-color: #FAFAFA;
  border-radius: 0.5rem;
  text-decoration: none;
  color: inherit;
  aspect-ratio: 1 / 1;
  overflow: hidden;
}
.usp-inner {
  display: flex;
  flex-direction: column;
  padding: 1rem;
  text-align: left;
  justify-content: flex-start;
}
.usp-icon {
  display: block;
  margin-bottom: 1rem;
}
.usp-icon.small {
  width: 32px;
  height: 32px;
}
.usp-icon.medium {
  width: 48px;
  height: 48px;
}
.usp-icon.large {
  width: 64px;
  height: 64px;
}
.usp-title {
  font-weight: 600;
  font-size: 1rem;
  margin-bottom: 0.5rem;
}
.usp-text {
  font-size: 0.875rem;
  color: #555;
}
.usp-arrows {
  position: absolute;
  top: -50px;
  right: 0;
  display: flex;
  gap: 8px;
}
.usp-arrow {
  display: flex;
  width: 32px;
  height: 32px;
  padding: 11px 0;
  justify-content: center;
  align-items: center;
  border-radius: 16px;
  border: 1px solid var(--Black, #1D1D1B);
  background: white;
  font-size: 16px;
  cursor: pointer;
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var flkty = new Flickity('.js-flickity');
    var prevBtn = document.querySelector('.usp-arrow.prev');
    var nextBtn = document.querySelector('.usp-arrow.next');

    if (prevBtn && nextBtn && flkty) {
      prevBtn.addEventListener('click', () => flkty.previous());
      nextBtn.addEventListener('click', () => flkty.next());
    }
  });
</script>
