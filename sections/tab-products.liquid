{{ 'section-tab-products.css' | asset_url | stylesheet_tag }}

{% comment %}
  Updated full section to reflect layout with:
  - Styled filters (with icons like image)
  - Adjustable title/text on image
  - Working collection and product list
  - Background, margins, paddings
  - Text/image styling per block
{% endcomment %}

<div class="tab-products section section-blends section-full text-custom"
  style="
    background: {% if section.settings.background_image != blank %}url('{{ section.settings.background_image | image_url }}'){% else %}{{ section.settings.background_color }}{% endif %};
    margin: {{ section.settings.margin_top | default: 0 }}px {{ section.settings.margin_right | default: 0 }}px {{ section.settings.margin_bottom | default: 0 }}px {{ section.settings.margin_left | default: 0 }}px;
    padding: {{ section.settings.padding_top | default: 0 }}px {{ section.settings.padding_right | default: 0 }}px {{ section.settings.padding_bottom | default: 0 }}px {{ section.settings.padding_left | default: 0 }}px;
  "
  data-section-id="{{ section.id }}">

  <div class="filters">
    <span>Filters:</span>
    <button class="filter-btn active" data-filter="all">üîç All</button>
    <button class="filter-btn" data-filter="full-sun">‚òÄ Full Sun</button>
    <button class="filter-btn" data-filter="partial-sun">‚õÖ Partial Sun</button>
  </div>

  <div class="tabs" style="--tab-position: {{ section.settings.tabs_position }}%;">
    {% for block in section.blocks %}
      <div class="tab-product" data-tab-id="{{ forloop.index0 }}">
        {{ block.settings.tab_label }}
      </div>
    {% endfor %}
  </div>

  {% for block in section.blocks %}
    <div class="tab-product-content" id="tab-product-content-{{ section.id }}-{{ forloop.index0 }}">
      <div style="position: relative; overflow: hidden;">
        {% if block.settings.image %}
          <img
            src="{{ block.settings.image | image_url: width: 1200 }}"
            alt="{{ block.settings.title }}"
            style="width: {{ block.settings.image_width | default: 100 }}%; height: auto;"
          />
        {% endif %}

        <div style="
          position: absolute;
          top: {{ block.settings.text_position_top | default: 30 }}%;
          left: {{ block.settings.text_position_left | default: 10 }}%;
          transform: translate(-{{ block.settings.text_position_left | default: 10 }}%, -{{ block.settings.text_position_top | default: 30 }}%);
          color: {{ block.settings.text_color | default: '#fff' }};
          font-size: {{ block.settings.heading_size | default: 28 }}px;
          max-width: {{ block.settings.content_max_width | default: 780 }}px;
          padding: 1rem;
          z-index: 2;
        ">
          <h3 style="margin: 0;">{{ block.settings.title }}</h3>
          {% if block.settings.inline_title != blank %}<span>{{ block.settings.inline_title }}</span>{% endif %}
          <div>{{ block.settings.description }}</div>
        </div>
      </div>

      <div class="product-list">
        {% if block.settings.collection and block.settings.collection.products_count > 0 %}
          {% for product in block.settings.collection.products %}
            <div class="product-card {% if product.tags contains 'Full Sun' %}full-sun{% elsif product.tags contains 'Partial Sun' %}partial-sun{% endif %}">
              {% render 'product-card', product: product %}
            </div>
          {% endfor %}
        {% else %}
          <p>No products available in this collection.</p>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

<script>
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const filter = btn.dataset.filter;
      document.querySelectorAll('.product-card').forEach(card => {
        card.style.display = filter === 'all' || card.classList.contains(filter) ? '' : 'none';
      });
    });
  });
</script>


{% schema %}
{
  "name": "Tab Products",
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "stack_products",
      "label": "Stack products",
      "default": true
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 2,
      "max": 10,
      "step": 1,
      "label": "Products to show",
      "default": 6
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "Products per row (mobile)",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "products_per_row_desktop",
      "min": 2,
      "max": 5,
      "label": "Products per row (desktop)",
      "default": 4,
      "step": 1
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Featured collection"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "url",
      "id": "link_url",
      "label": "Link URL",
      "info": "Default to collection URL."
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "Link text",
      "default": "View all"
    },
    {
      "type": "checkbox",
      "id": "enable_parallax",
      "label": "Enable parallax effect",
      "info": "Parallax crops images.",
      "default": false
    },
    {
      "type": "select",
      "id": "image_size",
      "label": "Image size",
      "options": [
        {
          "value": "auto",
          "label": "Original image ratio"
        },
        {
          "value": "sm",
          "label": "Small"
        },
        {
          "value": "md",
          "label": "Medium"
        },
        {
          "value": "lg",
          "label": "Large"
        },
        {
          "value": "fill",
          "label": "Fill screen"
        }
      ],
      "info": "Choose \"Original image ratio\" to avoid image cropping. [Learn more](https://help.shopify.com/en/manual/online-store/images/theme-images#best-practices-for-slideshows-and-full-widtw-images)",
      "default": "auto"
    },
    {
      "type": "select",
      "id": "mobile_text_position",
      "label": "Mobile content position",
      "options": [
        {
          "value": "place-self-start text-start",
          "label": "Top left"
        },
        {
          "value": "place-self-start-center text-center",
          "label": "Top center"
        },
        {
          "value": "place-self-start-end text-end",
          "label": "Top right"
        },
        {
          "value": "place-self-center-start text-start",
          "label": "Middle left"
        },
        {
          "value": "place-self-center text-center",
          "label": "Middle center"
        },
        {
          "value": "place-self-center-end text-end",
          "label": "Middle right"
        },
        {
          "value": "place-self-end-start text-start",
          "label": "Bottom left"
        },
        {
          "value": "place-self-end-center text-center",
          "label": "Bottom center"
        },
        {
          "value": "place-self-end text-end",
          "label": "Bottom right"
        }
      ],
      "default": "place-self-center text-center"
    },
    {
      "type": "select",
      "id": "desktop_text_position",
      "label": "Desktop content position",
      "options": [
        {
          "value": "sm:place-self-start sm:text-start",
          "label": "Top left"
        },
        {
          "value": "sm:place-self-start-center sm:text-center",
          "label": "Top center"
        },
        {
          "value": "sm:place-self-start-end sm:text-end",
          "label": "Top right"
        },
        {
          "value": "sm:place-self-center-start sm:text-start",
          "label": "Middle left"
        },
        {
          "value": "sm:place-self-center sm:text-center",
          "label": "Middle center"
        },
        {
          "value": "sm:place-self-center-end sm:text-end",
          "label": "Middle right"
        },
        {
          "value": "sm:place-self-end-start sm:text-start",
          "label": "Bottom left"
        },
        {
          "value": "sm:place-self-end-center sm:text-center",
          "label": "Bottom center"
        },
        {
          "value": "sm:place-self-end sm:text-end",
          "label": "Bottom right"
        }
      ],
      "default": "sm:place-self-center sm:text-center"
    },
    {
      "type": "range",
      "id": "tabs_position",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Tab vertical position",
      "default": 30
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Tab",
      "settings": [
        {
          "type": "text",
          "id": "tab_label",
          "label": "Tab Label"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading"
        },
        {
          "type": "select",
          "id": "heading_tag",
          "label": "Heading size",
          "options": [
            {
              "value": "h2",
              "label": "Large"
            },
            {
              "value": "h3",
              "label": "Medium"
            }
          ],
          "default": "h2"
        },
        {
          "type": "text",
          "id": "inline_title",
          "label": "Product inline title",
          "default": "Series"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description"
        },
        {
          "type": "range",
          "id": "content_max_width",
          "label": "Content maximum width",
          "min": 400,
          "max": 1200,
          "step": 20,
          "unit": "px",
          "default": 780
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#000000"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Banner Image"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "header",
          "content": "Featured product 1"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        },
        {
          "type": "text",
          "id": "product_title",
          "label": "Product title",
          "default": "New Nano AI"
        },
        {
          "type": "text",
          "id": "product_description",
          "label": "Product description",
          "default": "<p>The new Nano AI is the most powerful device we've ever created.</p>"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product image"
        },
        {
          "type": "header",
          "content": "Featured product 2"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product"
        },
        {
          "type": "text",
          "id": "product_title_2",
          "label": "Product title",
          "default": "New Nano AI"
        },
        {
          "type": "text",
          "id": "product_description_2",
          "label": "Product description",
          "default": "The new Nano AI is the most powerful device we've ever created."
        },
        {
          "type": "image_picker",
          "id": "product_image_2",
          "label": "Product image"
        },
        {
          "type": "header",
          "content": "Styling"
        },
        {
        "type": "color",
        "id": "featured_text_color",
        "label": "Featured text color"
      },
        {
        "type": "color",
        "id": "background",
        "label": "Button Background"
      },
      {
        "type": "color",
        "id": "btn_text_color",
        "label": "Button text color"
      }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tab products",
      "category": "Somos Custom"
    }
  ]
}
{% endschema %}
