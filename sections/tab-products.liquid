{% comment %}
  Updated Tab Products Section with:
  - Filters (All / Full Sun / Partial Sun)
  - Corrected text over image positioning
  - Background, margin, padding support
  - Individual text styling (color, size)
  - Adjustable image size and source
{% endcomment %}

<div class="tab-products section section-blends section-full text-custom"
  style="
    background: {{ section.settings.background_image != blank ? 'url(' | append: section.settings.background_image | append: ')' : section.settings.background_color }};
    margin: {{ section.settings.margin_top }}px {{ section.settings.margin_right }}px {{ section.settings.margin_bottom }}px {{ section.settings.margin_left }}px;
    padding: {{ section.settings.padding_top }}px {{ section.settings.padding_right }}px {{ section.settings.padding_bottom }}px {{ section.settings.padding_left }}px;
  "
  data-section-id="{{ section.id }}">

  <div class="product-filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="full-sun">☀ Full Sun</button>
    <button class="filter-btn" data-filter="partial-sun">⛅ Partial Sun</button>
  </div>

  <div class="tabs" style="--tab-position: {{ section.settings.tabs_position }}%;">
    {% for block in section.blocks %}
      <div class="tab-product" data-tab-id="{{ forloop.index0 }}">
        {{ block.settings.tab_label }}
      </div>
    {% endfor %}
  </div>

  {% for block in section.blocks %}
    <div class="tab-product-content" id="tab-product-content-{{ section.id }}-{{ forloop.index0 }}">
      <image-banner style="position: relative; display: block; overflow: hidden;">
        {% if block.settings.image %}
          <img src="{{ block.settings.image | image_url }}" style="width: {{ block.settings.image_width }}%; height: auto;" />
        {% endif %}

        <div class="tab-product-content__info {{ section.settings.mobile_text_position }} {{ section.settings.desktop_text_position }}"
             style="
               position: absolute;
               z-index: 2;
               max-width: {{ block.settings.content_max_width }}px;
               color: {{ block.settings.text_color }};
               font-size: {{ block.settings.heading_size }}px;
               padding: 1rem;">
          <h3 style="margin: 0;">{{ block.settings.title }}</h3>
          {% if block.settings.inline_title != blank %}
            <span>{{ block.settings.inline_title }}</span>
          {% endif %}
          <div>{{ block.settings.description }}</div>
        </div>
      </image-banner>

      <product-list class="product-list">
        {% assign products = block.settings.collection.products %}
        {% for product in products %}
          <div class="product-card {% if product.tags contains 'Full Sun' %}full-sun{% elsif product.tags contains 'Partial Sun' %}partial-sun{% endif %}">
            {% render 'product-card', product: product %}
          </div>
        {% endfor %}
      </product-list>
    </div>
  {% endfor %}
</div>

<script>
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const filter = btn.dataset.filter;
      document.querySelectorAll('.product-list > .product-card').forEach(card => {
        card.style.display = (filter === 'all' || card.classList.contains(filter)) ? '' : 'none';
      });
    });
  });
</script>
